/**
 * It is the admin script file.
 *
 * @package woorestaurant
 */

! (function (a) {
	"use strict";
	a( document ).ready(
		function () {
			function e(i) {
				i.length &&
					i.find( ".wrmb-group-title" ).each(
						function () {
							var e,
							t = a( this ),
							o = t.next().find( '[id$="_name"]' ).val();
							o ||
							((o = i.find( "[data-grouptitle]" ).data( "grouptitle" )) &&
							((e = t.parents( "[data-iterator]" ).data( "iterator" )),
							(o = o.replace( "{#}", e + 1 )))),
							o && t.text( o );
						}
					);
			}
			jQuery( "#woores_addition_options" )
			.on( "wrmb2_add_row wrmb2_shift_rows_complete", e )
			.on(
				"keyup",
				function (e) {
					var t = a( e.target ),
					o     = "name";
					- 1 !== e.target.id.indexOf( o, e.target.id.length - o.length ) &&
					t
					.parents( ".wrmb-row.wrmb-repeatable-grouping" )
					.find( ".wrmb-group-title" )
					.text( t.val() );
				}
			),
			e( jQuery( "#woores_addition_options" ) ),
			jQuery( "body" ).on(
				"click",
				function () {
					e( jQuery( "#woores_addition_options" ) );
				}
			),
			0 <
			jQuery(
				"#wrmb2-metabox-woores_addition_options.wrmb2-metabox .extype-option select"
			).length &&
			(jQuery(
				"#wrmb2-metabox-woores_addition_options.wrmb2-metabox .extype-option select"
			).each(
				function () {
					var e = a( this ),
					t     = e.val();
					"" != t &&
					e
					.closest( ".postbox.wrmb-repeatable-grouping" )
					.addClass( "wrs-otype-" + t );
				}
			),
			jQuery( "body" ).on(
				"change",
				"#wrmb2-metabox-woores_addition_options.wrmb2-metabox .extype-option select",
				function () {

					var e = a( this ),
					t     = e.val();
					e
					.closest( ".postbox" )
					.find( '.woores-options input[type="checkbox"]' )
					.prop( "checked", ! 1 ),
					e
					.closest( ".postbox.wrmb-repeatable-grouping" )
					.removeClass(
						function (e, t) {
							return (t.match( /(^|\s)wrs-otype\S+/g ) || []).join( " " );
						}
					),
					"" != t &&
					e
						.closest( ".postbox.wrmb-repeatable-grouping" )
						.addClass( "wrs-otype-" + t );
				}
			)),
			a( "body" ).on(
				"change",
				'.wrmb-type-price-options .woores-options input[type="checkbox"]',
				function () {
					var e = a( this ),
					t     = e
						.closest( ".wrmb-type-price-options" )
						.find(
							'.woores-options.woores-def-option input[type="checkbox"]:checked'
						).length;
						(e.closest( ".postbox.wrs-otype-radio" ).length ||
						e.closest( ".postbox.wrs-otype-select" ).length) &&
						1 < t &&
						(e
						.closest( ".wrmb-type-price-options" )
						.find( '.woores-options.woores-def-option input[type="checkbox"]' )
						.prop( "checked", ! 1 ),
						(this.checked = ! 0),
						event.preventDefault());
				}
			),
			a( "body" ).on(
				"click",
				".woores-gr-option a:not(.woores-copypre):not(.woores-copy):not(.woores-paste)",
				function () {
					var e = a( this );
					e
					.closest( ".wrmb-field-list" )
					.find( ".woores-gr-option a" )
					.removeClass( "current" ),
					e.addClass( "current" );
					var t = e.attr( "data-remove" ),
					o     = e.attr( "data-add" );
					e.closest( ".wrmb-field-list" ).find( t ).fadeOut(),
					e.closest( ".wrmb-field-list" ).find( o ).fadeIn();
				}
			),
			jQuery( "body" ).on(
				"change",
				".woores-options.woores-val-option select",
				function () {
					jQuery( this ).next().val( jQuery( this ).val() );
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-copypre",
				function () {
					var e = a( this ).closest( ".wrmb-repeatable-grouping" ),
					t     = e.prev();
					e
					.find( ".woores-op-name .wrmb-td input" )
					.val( t.find( ".woores-op-name .wrmb-td input" ).val() ),
					e
						.find( ".woores-op-type .wrmb-td select" )
						.val( t.find( ".woores-op-type .wrmb-td select" ).val() )
						.trigger( "change" ),
					e
						.find( ".woores-op-rq .wrmb-td select" )
						.val( t.find( ".woores-op-rq .wrmb-td select" ).val() ),
					e
						.find( ".woores-op-min .wrmb-td input" )
						.val( t.find( ".woores-op-min .wrmb-td input" ).val() ),
					e
						.find( ".woores-op-max .wrmb-td input" )
						.val( t.find( ".woores-op-max .wrmb-td input" ).val() );
					var o = e
					.find( ".woores-op-name .wrmb-td input" )
					.attr( "name" )
					.split( "][" )[0]
					.match( /\d+/ ),
					i     = t.find( ".woores-op-ops .wrmb-td .wrmb-field-list" ).html();
					e.find( ".woores-op-ops .wrmb-td .wrmb-field-list" ).html( i ),
					e
						.find( ".woores-op-ops .wrmb-td .wrmb-field-list input" )
						.each(
							function () {
								var e = (t = a( this ).attr( "name" )).split( "][" ),
								t     = t.replace( e[0], "woores_options[" + o );
								a( this ).attr( "name", t );
							}
						),
						e
						.find( ".woores-op-tpr .wrmb-td select" )
						.val( t.find( ".woores-op-tpr .wrmb-td select" ).val() ),
						e
						.find( ".woores-op-pri .wrmb-td input" )
						.val( t.find( ".woores-op-pri .wrmb-td input" ).val() );
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-copy",
				function () {
					var e = a( "<input class='woores-ctcopy'>" ),
					t     = a( this ).closest( ".wrmb-repeatable-grouping" );
					a( "body" ).append( e ),
					e.val( t.html() ).select(),
					document.execCommand( "copy" ),
					e.remove();
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-paste",
				function (e) {
					a( this ).find( ".woores-ctpaste" ).fadeIn(),
					a( this ).find( ".woores-paste-tt" ).css( "display", "block" ),
					a( this ).find( ".woores-paste-mes" ).css( "display", "none" );
				}
			),
			jQuery( "#woores_addition_options" ).length &&
			jQuery( document ).on(
				"click",
				function (e) {
					0 === a( e.target ).closest( ".woores-paste" ).length &&
					a( ".woores-ctpaste" ).fadeOut(),
					0 === a( e.target ).closest( ".woores-val-option" ).length &&
					a( ".woores-list-value" ).fadeOut();
				}
			),
			a( "body" ).on(
				"paste",
				".woores-ctpaste",
				function () {
					var i = a( this ),
					n     = i.closest( ".wrmb-repeatable-grouping" );
					setTimeout(
						function () {
							var e = i.val(),
							e     = a( "<div>" + e + "<div>" );
							n
							.find( ".woores-op-name .wrmb-td input" )
							.val( e.find( ".woores-op-name .wrmb-td input" ).val() ),
							n
							.find( ".woores-op-type .wrmb-td select" )
							.val( e.find( ".woores-op-type .wrmb-td select" ).val() )
							.trigger( "change" ),
							n
							.find( ".woores-op-rq .wrmb-td select" )
							.val( e.find( ".woores-op-rq .wrmb-td select" ).val() ),
							n
							.find( ".woores-op-min .wrmb-td input" )
							.val( e.find( ".woores-op-min .wrmb-td input" ).val() ),
							n
							.find( ".woores-op-max .wrmb-td input" )
							.val( e.find( ".woores-op-max .wrmb-td input" ).val() );
							var o = n
							.find( ".woores-op-name .wrmb-td input" )
							.attr( "name" )
							.split( "][" )[0]
							.match( /\d+/ ),
							t     = e.find( ".woores-op-ops .wrmb-td .wrmb-field-list" ).html();
							n.find( ".woores-op-ops .wrmb-td .wrmb-field-list" ).html( t ),
							n
							.find( ".woores-op-ops .wrmb-td .wrmb-field-list input" )
							.each(
								function () {
									var e = (t = a( this ).attr( "name" )).split( "][" ),
									t     = t.replace( e[0], "woores_options[" + o );
									a( this ).attr( "name", t );
								}
							),
							n
							.find( ".woores-op-tpr .wrmb-td select" )
							.val( e.find( ".woores-op-tpr .wrmb-td select" ).val() ),
							n
							.find( ".woores-op-pri .wrmb-td input" )
							.val( e.find( ".woores-op-pri .wrmb-td input" ).val() ),
							i
							.closest( ".woores-paste" )
							.find( ".woores-paste-tt" )
							.css( "display", "none" ),
							i
							.closest( ".woores-paste" )
							.find( ".woores-paste-mes" )
							.css( "display", "block" ),
							i.val( "" ).fadeOut();
						},
						100
					);
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".wrmb-add-row button",
				function (e) {
					a( this )
					.closest( ".wrmb-row" )
					.prev()
					.find( ".woores-paste-mes" )
					.css( "display", "none" ),
					a( this )
						.closest( ".wrmb-row" )
						.prev()
						.find( ".woores-paste-tt" )
						.css( "display", "block" ),
					a( this )
						.closest( ".wrmb-row" )
						.prev()
						.find( ".woores-copy" )
						.addClass( "disabled" )
						.css( "opacity", "0.5" ),
					a( this )
						.closest( ".wrmb-row" )
						.prev()
						.find(
							".woores-con-logic .woores-stcon-logic .woores-options.woores-type_op-option select option"
						)
						.prop( "disabled", ! 1 );
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-copy.disabled",
				function (e) {
					alert( a( this ).attr( "data-textdis" ) );
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-con-logic .woores-val-option",
				function (e) {
					var t = a( this ),
					o     = t
						.closest( ".wrmb-td" )
						.find( ".woores-type_op-option select" )
						.val();
					"varia" == o
					? (t
						.find( ".woores-list-value li:not(.woores-variation)" )
						.css( "display", "none" ),
						t
					.find( ".woores-list-value li.woores-variation" )
					.css( "display", "block" ))
						: (t.find( ".woores-list-value li" ).css( "display", "none" ),
						t.find( ".woores-list-value li." + o ).css( "display", "block" )),
						t.find( ".woores-list-value li" ).hasClass( o )
						? t.find( "input" ).attr( "readonly", ! 0 )
						: t.find( "input" ).attr( "readonly", ! 1 ),
						t.find( ".woores-list-value" ).fadeIn();
				}
			),
			jQuery( "#woores_addition_options" ).on(
				"click",
				".woores-con-logic .woores-list-value li",
				function (e) {
					var t = a( this );
					e.stopPropagation(),
					t
						.closest( ".woores-val-option" )
						.find( "li" )
						.removeClass( "woores-current" ),
					t.addClass( "woores-current" ),
					t
						.closest( ".woores-val-option" )
						.find( ".woores-conval" )
						.val( t.attr( "data-val" ) ),
					a( ".woores-list-value" ).fadeOut();
				}
			),
			a( "body" ).on(
				"click",
				".wrsf-collapse .wrmb-type-title",
				function (e) {
					var t = a( this );
					a( t ).next( ".wrsf-collapse-con" ).slideToggle( 200 ),
					t.hasClass( "wrsf-active" )
					? t.removeClass( "wrsf-active" )
					: t.addClass( "wrsf-active" );
				}
			);
		}
	);
})( jQuery );
